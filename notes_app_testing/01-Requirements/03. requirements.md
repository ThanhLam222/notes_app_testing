## Requirements and User stories
### A. Functional requirements and user stories
**1. Sign up**
**1.1. US-01. Sign up**
* **User story:** As a new user, I want to sign up, so that I can create my own account and save my notes securely.
* **Acceptance Criteria:**
  * **US-01.AC-01: View sign up form**
    * **Given:** The user is not authenticated
    * **When:** They navigate to the **Sign up page**
    * **Then:** The page is displayed with page's title, form fields (required fields: email, password, confirm password; optional field: name), "Signup" button and linkable text that links to the **Sign in page** clearly visible.

  * **US-01.AC-02: Successful sign up** 
    * **Given:** The user is on Sign up page
    * **When:** They fill in all required fields (email, password, confirm password) and the optional field (name) with valid information and click "Signup" button
    * **Then:** A new user account is created in the database (password will be encrypted before saving), a success message "You are registered." with "Close" button is displayed, and the user is redirected to **Sign in page**.

  * **US-01.AC-03: Failed sign up - Missing required fields**
    * **Priority:** Checked before all other validations (in case of frontend: invalid email is validated first because form not submitted).
    * **Given:** The user is on Sign up page
    * **When:** They leave one or more required fields (email, password, confirm password) empty and click "Signup" button
    * **Then:** 
      * The sign up request must not succeed.
      * An error: "Please fill out all required fields (email/password/confirm password)" with "Close" button is displayed, and the user remains on **Sign up page** with filled data.


  * **US-01.AC-04: Failed sign up - Email existing**
    * **Priority:** Checked only if required fields are not empty.
    * **Given:** The user is on Sign up page
    * **When:** They fill in the form with an existing email
    * **Then:** "The Email is already in use." error with "Close" button is displayed, and the user remains on the **Sign up page**.

  * **US-01.AC-05: Failed sign up - Form validation errors**
    * **Priority:** Checked only if required fields are not empty and email is not existing.
    * **Given:** The user is on Sign up page
    * **When:** They fill in the form with one or more following validation errors:
      * The entered passwords do not match
      * The password is less than 4 characters long
      * The email is in an invalid format (Email must follow a valid format: Must contain one @ character.)
    * **Then:** All passwords error messages ("Passwords do not match." "Password must be at least 4 characters.") with "Close" button are displayed and the user remains on the **Sign up page** with filled data.
    * **And:** **Additionally:** In case of invalid email, the frontend prevents form submission, and if the request is sent directly to the backend, the API returns a standardized error message (“Email address is invalid”).



**2. Sign in**
**2.1. US-02. Sign in**
* **User story:** As an existing user, I want to sign in, so that I can access and manage my notes.
* **Acceptance Criteria:**
  * **US-02.AC-01: View sign in form**
    * **Given:** The user is not signed in
    * **When:** They navigate to the **Sign in page**
    * **Then:** The page is displayed with page's title, required form fields (email, password), "Signin" button and linkable text that links to the **Sign up page** clearly visible.

  * **US-02.AC-02: Successful sign in**
    * **Given:** The user is on Sign in page
    * **When:** They fill in all fields (email, password) with valid information and click "Signin" button
    * **Then:** The user is redirected to the **All notes page**.
    * **And:** The sessionID is renew for new session.

  * **US-02.AC-03: Failed sign in - Missing fields**
    * **Priority:** Checked before all other validations.
    * **Given:** The user is on **Sign in page**
    * **When:** They leave one or more fields (email, password) empty and click "Signin" button
    * **Then:** "Missing credentials" error message with "Close" button is displayed, and the user remains on the **Sign in page**.


  * **US-02.AC-04: Failed sign in - Invalid data**
    * **Given:** The user is on **Sign in page**
    * **When:** They fill in the form with an incorrect email and/or an incorrect password
    * **Then:** Either "Not User found." or "Incorrect Password." error with "Close" button is displayed, and the user remains on the **Sign in page**.
      * (Note: If not user found, dont check password.)
      
**3. CRUD**
**3.1. US-03. Create new note**
* **User story:** As a logged-in user, I want to create new note, so that I can save my thoughts and ideas at any time.
* **Acceptance Criteria:**
  * **US-03.AC-01: View new note form**
    * **Given:** The user is logged-in
    * **When:** They navigate to the **New note page**
    * **Then:** The page is displayed with page's title, form fields (title, description), "Save" button clearly visible.

  * **US-03.AC-02: Successful note creation**
    * **Given:** The user is logged-in and on the **New note page**
    * **When:** They fill in all fields (title, description) with valid information and click "Save" button
    * **Then:** A new note is saved to the database, the user is redirected to the **All notes page**, and success message "Note Added Successfully" with "Close" button is displayed.

  * **US-03.AC-03: Failed note creation - Missing fields**
    * **Given:** The user is logged-in and on the **New note page**
    * **When:** They leave one or both fields (title, description) empty and click "Save" button
    * **Then:** One or both applicable error messages ("Please Write a Title.", "Please Write a Description") with "Close" button are displayed, and the user remains on the **New note page** with filled data.

  * **US-03.AC-04: Failed note creation - User not logged in**
    * **Given:** The user is not logged-in
    * **When:** They navigate to the URL for the **New note page**.
    * **Then:** The user is redirected to the **Sign in page**, and error message "Not Authorized." with "Close" button is displayed.

**3.2. US-04. Read all notes**
* **User story:** As a logged-in user, I want to read all my own notes, so that I can review and manage my thoughts effectively.
* **Acceptance criteria:**
  * **US-04.AC-01: Successful reading (with notes)**
    * **Given:** The user is logged-in and has created at least one note
    * **When:** They navigate to the **All notes page**
    * **Then:** The page displays a list of their notes with the title and description clearly visible, ordered by date descending, each note has "edit" icon and "Delete" button.

  * **US-04.AC-02: Successful reading (no notes)**
    * **Given:** The user is logged-in and has no notes
    * **When:** They navigate to the **All notes page**
    * **Then:** The page displays text "Hello {{username}}", "There are not Notes yet." and a linkable text "Create One!".

  * **US-04.AC-03: Failed reading - User not logged in**
    * **Given:** The user is not logged-in
    * **When:** They navigate to the URL for the **All notes page**.
    * **Then:** The user is redirected to the **Sign in page**, and error message "Not Authorized." with "Close" button is displayed.


**3.3. US-05. Update note**
* **User story:** As a logged-in user, I want to view and edit my own notes, so that I can correct or refine my ideas and information.
* **Acceptance criteria:**
  * **US-05.AC-01: Successful view note for Editing**
    * **Given:** The user is logged-in, is on the **All notes page**, and is the owner of a note
    * **When:** They click to "edit" icon for that note
    * **Then:** The **Edit note page** displays the note's title and description, "Save" button clearly visible.

  * **US-05.AC-02: Failed View Note for Editing - Not Authorized**
    * **Given:** The user is logged-in, and attempts to access the **Edit note page** for a note they do not own
    * **When:** They navigate to the URL for the **Edit note page**
    * **Then:** The user is redirected to the **All notes page**, and error message "Not Authorized" with "Close" button is displayed.

  * **US-05.AC-03: Successful note update**
    * **Given:** The user is logged-in, is the owner of the note and is on the **Edit note page**
    * **When:** They change either one or both fields (title, description) with valid information and click "Save" button
    * **Then:** The user is redirected to the **All notes page**, an updated note is saved to the database, success message "Note Updated Successfully" with "Close" button is displayed.
  
  * **US-05.AC-04: Failed note update - Missing required fields**
    * **Given:** The user is logged-in, is the owner of the note and is on the **Edit note page**
    * **When:** They leave either one or both fields (title, description) empty and click "Save" button
    * **Then:** One or both applicable error messages ("Please Write a Title.", "Please Write a Description") with "Close" button are displayed, and the user remains on the **Edit note page** with previously filled data.
  
  * **US-05.AC-05: Failed note update - Not owner**
    * **Given:** The user is logged-in
    * **When:** They attempt to update a note that they do not own.
    * **Then:** The note is not updated in the database, and the user is redirected to the **All notes page**, and error message "Not Authorized" with "Close" button is displayed.

  * **US-05.AC-06: Failed note update - Not logged in**
    * **Given:** The user is not logged-in
    * **When:** They attempt to access the **Edit note page** for a note
    * **Then:** The user is redirected to the **Sign in page**, and error message "Not Authorized." with "Close" button is displayed.

**3.4. US-06. Delete note**
* **User story:** As a logged-in user, I want to delete my own notes, so that I can keep my list of notes organized and free of clutter.
* **Acceptance criteria:**
  * **US-06.AC-01: Successful note deletion**
    * **Given:** The user is logged-in, is the owner of the note and is on the **All note page**
    * **When:** They click "Delete" icon of a note
    * **Then:** The user is redirected to the **All notes page**, the note is deleted from the database, success message "Note Deleted Successfully" with "Close" button is displayed.

  * **US-06.AC-02: Failed note deletion - Not owner**
    * **Given:** The user is logged-in
    * **When:** They attempt to delete a note that they do not own.
    * **Then:** The note is not deleted from the database, and the user is redirected to the **All notes page**, and error message "Not Authorized" with "Close" button is displayed.
  
  * **US-06.AC-03: Failed note deletion - Not logged in**
    * **Given:** The user is not logged-in
    * **When:** They attempt to delete a note
    * **Then:** The user is redirected to the **Sign in page**, and error message "Not Authorized." with "Close" button is displayed.
  
**4. See information about notes-app**
**4.1. US-07: See App Information**
* **User story:** As a user, I want to see information about the app, so that I can understand its purpose get started easily.
* **Acceptance criteria:**
  * **US-07.AC-01: Displaying app information on the Index page**
    * **Given:** The user is on any page of the app
    * **When:** They visit the application's root URL (the Index page)
    * **Then:** The **Index page** is displayed, it contains the app's name, a description of its purpose, and information about the technologies used
    * **And:** There is a prominent call-to-action (CTA) button, such as "Register", that links to the registration page

  * **US-07.AC-02: Displaying app information on the About page**
    * **Given:** The user is on any page of the app
    * **When:** They click on "About" link in the navigation bar
    * **Then:** The **About page** is displayed, the H1 heading "About" is clearly visible, a paragraph of text is displayed below the heading.

**5. Log out**
**5.1. US-08: Log out**
* **User story:** As a logged-in user, I want to log out of my account, so that I can secure my session and prevent unauthorized access.
* **Acceptance criteria:**
  * **US-08.AC-01: Successful logged out** - 
    * **Given:** The user is logged-in, and is on any page of the app
    * **When:** They click on "Log out" link in the navigation bar
    * **Then:** The user is redirected to **Sign in page** and success message "You are logged out now." with "Close" button is displayed.
    * **And:** The existing session ID is invalidated and destroyed on the server.

    * **US-08.AC-02: Failed note update - Not logged in**
    * **Given:** The user is not logged-in
    * **When:** They attempt to log out
    * **Then:** The user is redirected to the **Sign in page**, and error message "Not Authorized." with "Close" button is displayed.

**6. US-09. Main Layout**
* **User Story:** As a user, I want a consistent and clear navigation system and message display, so that I can easily navigate the application and understand the status of my actions.
* **Acceptance criteria:**
  * **US-09.AC-01: Page Title**
    * **Given:** The user is on any page of the application.
    * **When:** The page is loaded.
    * **Then:** The page title on the browser tab is displayed as "Notes App".
  
  * **US-09.AC-02: Link to the root URL (/)**
    * **Given:** The user is on any page of the application.
    * **When:** The page is loaded.
    * **Then:** There is "Notes app" link that links to the root URL (/).

  * **US-09.AC-03: Link to About page**
    * **Given:** The user is on any page of the application.
    * **When:** The page is loaded.
    * **Then:** There is "About" link that links to the `/about`.

  * **US-09.AC-04: Navigation Bar for non-loggined-in users**
    * **Given:** The user is not authenticated.
    * **When:** They are on any public page (e.g., Index, Sign In, Sign Up).
    * **Then:** The navigation bar is displayed at the top, containing a link to the Sign in page, and a link to the Sign up page. The logged-in user's dropdown menu is not visible.
    
  * **US-09.AC-05: Navigation Bar for logged-in users**
    * **Given:** The user is authenticated.
    * **When:** They are on any page (e.g., All Notes, New Note, About).
    * **Then:** The navigation bar is displayed at the top, containing a dropdown menu with items that link to the All notes page, New note page, and Log out endpoint. The links for "Login" and "Register" are not visible.
  
  * **US-09.AC-06: Flash/Error Messages Display**
    * **Given:** The application is on any page that triggers a message (success or error)
    * **When:** The system needs to display a message to the user.
    * **Then:** Flash/ error messages with "Close" button are shown at the top of the page, immediately below the navigation bar.

### B. Non-functional requirements
* **NFR-01: Password Hashing**
  * The system MUST hash user passwords using a secure cryptographic algorithm like bcrypt before storing them in the database.

  * **Test scenario:**
    * **Objective:** To verify that user passwords are not stored as plain text.
    * **Steps:**
      1. Register a new user account with a simple password.
      2. Access the database directly.
      3. Locate the new user's record.
      4. Verification: Confirm that the password field is a long, hashed string and does not match the plain text.


* **NFR-2: User-Friendly Error Pages**
  * The system MUST handle common errors gracefully by displaying a user-friendly page without exposing sensitive server information.
  * **Test scenarios:**
    * **Scenario 1: 404 Not Found page**
      * **Objective:** To verify the system displays a proper 404 page for non-existent URLs.
      * **Steps:**
        1. Navigate to the URL that does not exist in the app.
        2. Verification: The browser displays a friendly 404 error page.

    * **Scenario 2: Internal Server Error page**
      * **Objective:** To verify the system displays a generic error page for unhandled server-side issues.
      * **Steps:**
        1. Trigger a server-side error.
        2. Verification: The browser displays a generic, uninformative error page.

### C. Database schema requirements
**C.1. User Schema**
  * **REQ-DB-01: Name field**
    * Type: String.
    * Required: false (Optional).
    * Trimmed: leading/trailing spaces removed.

  * **REQ-DB-02: Email field**
    * Type: String.
    * Required: true.
    * Unique: true.
    * Trimmed: leading/trailing spaces removed.
    * Format: valid email (example@domain.com).

  * **REQ-DB-03: Password field**
    * Type: String.
    * Required: true.
    * Min length: 4 characters.

  * **REQ-DB-04: Timestamps for User**
    * createdAt: automatically set when document is created.
    * updatedAt: automatically updated when document is modified.
  
**C.2. Note Schema**
  * **REQ-DB-05: Title field**
    * Type: String.
    * Required: true.
  
  * **REQ-DB-06: Description field**
    * Type: String.
    * Required: true.

  * **REQ-DB-07: User field**
    * Type: String.
    * Required: true.
  
  * **REQ-DB-08: Timestamps for Note**
    * createdAt: automatically set when document is created.
    * updatedAt: automatically updated when document is modified.
**C.3. Session Management**
  * **REQ-SESSION-01: Session storage**
    * Sessions must be stored in MongoDB collection `sessions` using `connect-mongo`.
  
  * **REQ-SESSION-02: Session creation**
    * A new session document must be created after successful login.
    * Session must include a reference to the authenticated user (e.g., `passport.user`).

  * **REQ-SESSION-03: Session termination**
    * On logout, the user field in session must be cleared (via `req.logout()`).
    * Session document may remain in DB but must no longer contain user data.

  * **REQ-SESSION-04: Flash messages**
    * Session must support one-time flash messages (e.g., after logout).
    * Flash message is cleared after being displayed once.

